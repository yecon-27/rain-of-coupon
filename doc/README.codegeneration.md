# 若依代码生成配置指南

## 红包雨抽奖活动 - 数据库表字段配置

---

## 🆕 流量控制系统表配置

### redpacket_activity_participants（活动参与者记录表）

**重要：这是流量控制系统的核心表，用于管理用户会话和队列**

| 字段名           | 字段描述         | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注                     |
| ---------------- | ---------------- | ---- | ---- | ---- | ---- | -------- | ------------------------ |
| id               | 记录 ID          | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增               |
| user_id          | 用户 ID          | ❌   | ❌   | ✅   | ✅   | EQ       | 可为空，支持匿名用户     |
| session_id       | 会话 ID          | ❌   | ❌   | ✅   | ✅   | LIKE     | 唯一标识，系统生成       |
| ip_address       | IP 地址          | ❌   | ❌   | ✅   | ✅   | LIKE     | 防刷检测                 |
| join_time        | 加入时间         | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 系统记录                 |
| leave_time       | 离开时间         | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 可为空                   |
| last_heartbeat   | 最后心跳时间     | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 用于检测活跃状态         |
| status           | 状态             | ❌   | ✅   | ✅   | ✅   | EQ       | 可手动调整用户状态       |
| queue_position   | 队列位置         | ❌   | ❌   | ✅   | ✅   | EQ       | 排队时的位置             |
| created_at       | 创建时间         | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 系统记录                 |
| updated_at       | 更新时间         | ❌   | ❌   | ✅   | ❌   | -        | 系统记录                 |

**表单控件建议：**
- `status`: 下拉选择框（active/queued/expired/left）

**字典配置建议：**
- `status`: 字典类型 `participant_status`
  - active: 活跃
  - queued: 排队中
  - expired: 已过期
  - left: 已离开

**生成配置要点：**
1. **类名**: RedpacketActivityParticipants
2. **功能名**: 活动参与者记录
3. **包路径**: com.ruoyi.redpacket
4. **模块名**: redpacket
5. **业务名**: participants
6. **作者**: ruoyi
7. **表前缀**: redpacket_

---

### redpacket_traffic_config（流量控制配置表）

**重要：流量控制系统的配置参数表**

| 字段名        | 字段描述   | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注                   |
| ------------- | ---------- | ---- | ---- | ---- | ---- | -------- | ---------------------- |
| id            | 配置 ID    | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增             |
| config_key    | 配置键     | ✅   | ❌   | ✅   | ✅   | LIKE     | 唯一标识，不可修改     |
| config_value  | 配置值     | ✅   | ✅   | ✅   | ❌   | -        | 核心字段，可修改       |
| description   | 配置描述   | ✅   | ✅   | ✅   | ✅   | LIKE     | 说明信息               |
| is_active     | 是否启用   | ✅   | ✅   | ✅   | ✅   | EQ       | 开关控制               |
| created_at    | 创建时间   | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 系统记录               |
| updated_at    | 更新时间   | ❌   | ❌   | ✅   | ❌   | -        | 系统记录               |

**表单控件建议：**
- `config_key`: 文本输入框（新增时可编辑，编辑时只读）
- `config_value`: 文本输入框
- `description`: 文本域
- `is_active`: 单选框（启用/禁用）

**字典配置建议：**
- `is_active`: 字典类型 `sys_yes_no`
  - true: 启用
  - false: 禁用

**生成配置要点：**
1. **类名**: RedpacketTrafficConfig
2. **功能名**: 流量控制配置
3. **包路径**: com.ruoyi.redpacket
4. **模块名**: redpacket
5. **业务名**: trafficConfig
6. **作者**: ruoyi
7. **表前缀**: redpacket_

---

### redpacket_traffic_stats（流量统计表）

**重要：流量统计数据表，主要用于监控和分析**

| 字段名               | 字段描述         | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注                 |
| -------------------- | ---------------- | ---- | ---- | ---- | ---- | -------- | -------------------- |
| id                   | 统计 ID          | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增           |
| stat_time            | 统计时间         | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 统计时间点           |
| active_users         | 活跃用户数       | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 当时活跃用户数       |
| queued_users         | 排队用户数       | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 当时排队用户数       |
| total_requests       | 总请求数         | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 累计请求数           |
| rejected_requests    | 被拒绝请求数     | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 被限流拒绝的请求数   |
| average_session_time | 平均会话时间     | ❌   | ❌   | ✅   | ❌   | -        | 平均会话时长（秒）   |
| created_at           | 创建时间         | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 系统记录             |

**表单控件建议：**
- 所有字段都是系统自动记录，不需要手动编辑

**生成配置要点：**
1. **类名**: RedpacketTrafficStats
2. **功能名**: 流量统计
3. **包路径**: com.ruoyi.redpacket
4. **模块名**: redpacket
5. **业务名**: trafficStats
6. **作者**: ruoyi
7. **表前缀**: redpacket_

**特殊说明：**
- 此表主要用于查看和分析，不允许手动增删改
- 建议生成后移除新增、编辑、删除按钮
- 可以添加图表展示功能

---

## 🆕 redpacket_user_participation_log（用户参与记录表）

**重要：这是新增的核心业务表，用于记录所有用户参与行为**

| 字段名              | 字段描述     | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注                   |
| ------------------- | ------------ | ---- | ---- | ---- | ---- | -------- | ---------------------- |
| id                  | 记录 ID      | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增             |
| user_id             | 用户 ID      | ❌   | ❌   | ✅   | ✅   | EQ       | 系统记录，不可编辑     |
| participation_time  | 参与时间     | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 系统记录，不可编辑     |
| ip_address          | IP 记录      | ❌   | ❌   | ✅   | ✅   | LIKE     | 防刷检测，不可编辑     |
| is_win              | 是否中奖     | ❌   | ❌   | ✅   | ✅   | EQ       | 系统记录，不可编辑     |
| prize_id            | 中奖奖品 ID  | ❌   | ❌   | ✅   | ✅   | EQ       | 外键关联，不可编辑     |
| prize_name          | 奖品名称     | ❌   | ❌   | ✅   | ✅   | LIKE     | 冗余字段，便于查询     |
| is_used             | 是否使用     | ❌   | ✅   | ✅   | ✅   | EQ       | 可手动修改使用状态     |

**表单控件建议：**
- `is_used`: 单选框（已使用/未使用）

**字典配置建议：**
- `is_win`: 字典类型 `redpacket_win_status`
  - 0: 未中奖
  - 1: 中奖
- `is_used`: 字典类型 `redpacket_use_status`
  - 0: 未使用
  - 1: 已使用

**生成配置要点：**
1. **类名**: RedpacketUserParticipationLog
2. **功能名**: 用户参与记录
3. **包路径**: com.ruoyi.redpacket
4. **模块名**: redpacket
5. **业务名**: participation
6. **作者**: ruoyi
7. **表前缀**: redpacket_

**特殊说明：**
- 此表是混合规则的核心表，记录所有参与行为（无论是否中奖）
- 主要用于查看、统计和分析，大部分字段不允许手动编辑
- 只有 `is_used` 字段允许管理员手动修改（用于优惠券使用状态管理）

---

## 1. redpacket_prize（奖品配置表）

| 字段名          | 字段描述   | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注          |
| --------------- | ---------- | ---- | ---- | ---- | ---- | -------- | ------------- |
| id              | 奖品 ID    | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增    |
| prize_name      | 奖品名称   | ✅   | ✅   | ✅   | ✅   | LIKE     | 核心字段      |
| total_count     | 奖品总数量 | ✅   | ✅   | ✅   | ❌   | -        | 数值输入      |
| remaining_count | 剩余数量   | ✅   | ✅   | ✅   | ❌   | -        | 数值输入      |
| probability     | 中奖概率   | ✅   | ✅   | ✅   | ❌   | -        | 小数输入(0-1) |

**表单控件建议：**

- `prize_name`: 文本输入框
- `total_count`: 数字输入框
- `remaining_count`: 数字输入框
- `probability`: 数字输入框（步长 0.0001）

---

## 2. redpacket_user_prize_log（用户抽奖记录表）

| 字段名     | 字段描述 | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注               |
| ---------- | -------- | ---- | ---- | ---- | ---- | -------- | ------------------ |
| id         | 记录 ID  | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增         |
| user_id    | 用户 ID  | ❌   | ❌   | ✅   | ✅   | EQ       | 系统记录，不可编辑 |
| prize_name | 奖品名称 | ❌   | ❌   | ✅   | ✅   | LIKE     | 系统记录，不可编辑 |
| is_win     | 是否中奖 | ❌   | ❌   | ✅   | ✅   | EQ       | 系统记录，不可编辑 |
| is_used    | 是否使用 | ❌   | ✅   | ✅   | ✅   | EQ       | 可手动修改使用状态 |
| created_at | 抽奖时间 | ❌   | ❌   | ✅   | ✅   | BETWEEN  | 系统记录，不可编辑 |
| ip_address | IP 记录  | ❌   | ❌   | ✅   | ✅   | LIKE     | 系统记录，不可编辑 |

**表单控件建议：**

- `is_used`: 单选框（已使用/未使用）

**特殊说明：** 此表主要用于查看和统计，大部分字段不允许手动编辑

---

## 3. redpacket_event_config（活动配置表）

| 字段名            | 字段描述         | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注           |
| ----------------- | ---------------- | ---- | ---- | ---- | ---- | -------- | -------------- |
| id                | 主键             | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增     |
| start_time        | 活动开始时间     | ✅   | ✅   | ✅   | ✅   | BETWEEN  | 日期时间选择器 |
| end_time          | 活动结束时间     | ✅   | ✅   | ✅   | ✅   | BETWEEN  | 日期时间选择器 |
| max_users         | 并发用户上限     | ✅   | ✅   | ✅   | ❌   | -        | 数值输入       |
| max_draws_per_day | 每日最大抽奖次数 | ✅   | ✅   | ✅   | ❌   | -        | 数值输入       |

**表单控件建议：**

- `start_time`: 日期时间选择器
- `end_time`: 日期时间选择器
- `max_users`: 数字输入框
- `max_draws_per_day`: 数字输入框

---

## 4. redpacket_image_resource（图片资源表）

| 字段名        | 字段描述     | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注             |
| ------------- | ------------ | ---- | ---- | ---- | ---- | -------- | ---------------- |
| id            | 资源 ID      | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增       |
| resource_name | 资源名称     | ✅   | ✅   | ✅   | ✅   | LIKE     | 核心字段         |
| resource_key  | 资源标识     | ✅   | ✅   | ✅   | ✅   | LIKE     | 唯一标识         |
| file_name     | 文件名       | ✅   | ✅   | ✅   | ❌   | -        | 文件名           |
| file_path     | 文件访问路径 | ✅   | ✅   | ❌   | ❌   | -        | 路径太长，不显示 |
| usage_scene   | 使用场景     | ✅   | ✅   | ✅   | ✅   | EQ       | 下拉选择         |
| description   | 描述         | ✅   | ✅   | ✅   | ❌   | -        | 文本域           |

**表单控件建议：**

- `resource_name`: 文本输入框
- `resource_key`: 文本输入框
- `file_name`: 文本输入框
- `file_path`: 文本输入框
- `usage_scene`: 下拉选择框
- `description`: 文本域

---

## 5. redpacket_top10_popular_food（TOP10 网络人气特色美食表）

| 字段名    | 字段描述 | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注           |
| --------- | -------- | ---- | ---- | ---- | ---- | -------- | -------------- |
| id        | 美食 ID  | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增     |
| food_name | 美食名称 | ✅   | ✅   | ✅   | ✅   | LIKE     | 核心字段       |
| ranking   | 排名     | ✅   | ✅   | ✅   | ✅   | EQ       | 数值输入(1-10) |

**表单控件建议：**

- `food_name`: 文本输入框
- `ranking`: 数字输入框（范围 1-10）

**验证规则：**

- `ranking`: 必须在 1-10 之间，且唯一

---

## 6. redpacket_town_specialty_food（"一镇一品"特色菜表）

| 字段名    | 字段描述  | 插入 | 编辑 | 列表 | 查询 | 查询方式 | 备注       |
| --------- | --------- | ---- | ---- | ---- | ---- | -------- | ---------- |
| id        | 特色菜 ID | ❌   | ❌   | ❌   | ❌   | -        | 主键，自增 |
| food_name | 美食名称  | ✅   | ✅   | ✅   | ✅   | LIKE     | 核心字段   |
| ranking   | 排名      | ✅   | ✅   | ✅   | ✅   | EQ       | 数值输入   |

**表单控件建议：**

- `food_name`: 文本输入框
- `ranking`: 数字输入框

---

## 查询方式说明

| 查询方式 | 说明     | 适用场景                |
| -------- | -------- | ----------------------- |
| EQ       | 等于     | 精确匹配，如状态、ID 等 |
| LIKE     | 模糊查询 | 文本搜索，如名称等      |
| BETWEEN  | 范围查询 | 时间范围、数值范围等    |

---

## 生成建议

### 功能权限配置：

- **奖品配置**: 增删改查
- **抽奖记录**: 查看、导出（不允许增删改）
- **活动配置**: 增删改查
- **图片资源**: 增删改查
- **美食管理**: 增删改查

### 菜单结构建议：

```
红包雨管理
├── 🆕 流量控制系统
│   ├── 活动参与者记录  (会话管理)
│   ├── 流量控制配置    (系统参数)
│   └── 流量统计       (监控数据)
├── 🆕 用户参与记录     (核心业务表)
├── 奖品配置
├── 抽奖记录 (旧表，可考虑废弃)
├── 活动配置
├── 图片资源
├── TOP10美食
└── 特色菜管理
```

### 特殊处理：

1. **流量统计表**: 设置为只读模式，只允许查看和导出，建议添加图表展示
2. **活动参与者记录表**: 主要用于监控，只允许查看和状态调整
3. **流量控制配置表**: 核心配置表，需要严格权限控制
4. **抽奖记录表**: 设置为只读模式，只允许查看和导出
5. **活动配置表**: 通常只有一条记录，可以设计为配置页面而非列表页面
6. **排名字段**: 需要添加唯一性验证
7. **时间字段**: 使用日期时间选择器，支持范围查询

---

## 代码生成后需要手动调整的地方

### 流量控制系统相关：
1. **活动参与者记录表**: 移除新增、删除按钮，只保留查看和状态编辑功能
2. **流量控制配置表**: 添加配置值的格式验证（数字、布尔值等）
3. **流量统计表**: 移除所有编辑功能，只保留查看和导出，建议添加图表展示

### 业务系统相关：
4. **用户参与记录表**: 移除新增、删除按钮，只允许查看和使用状态修改
5. **抽奖记录表**: 移除新增、编辑按钮，只保留查看功能
6. **活动配置表**: 可能需要改为单条记录的配置页面
7. **排名字段**: 添加唯一性校验和范围校验
8. **文件上传**: 图片资源表可能需要集成文件上传功能
9. **状态字段**: 使用字典配置，显示中文标签

### 权限控制建议：
- **流量控制配置**: 只有超级管理员可以修改
- **统计数据**: 只读权限，可导出
- **参与者记录**: 运营人员可查看，管理员可调整状态
- **业务数据**: 根据角色分配不同的操作权限

这个配置可以让你快速生成基础的 CRUD 功能，然后根据实际业务需求进行调整。
