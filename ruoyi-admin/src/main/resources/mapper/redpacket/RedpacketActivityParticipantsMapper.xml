<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.redpacket.mapper.RedpacketActivityParticipantsMapper">
    
    <resultMap type="RedpacketActivityParticipants" id="RedpacketActivityParticipantsResult">
        <result property="id"    column="id"    />
        <result property="userId"    column="user_id"    />
        <result property="sessionId"    column="session_id"    />
        <result property="ipAddress"    column="ip_address"    />
        <result property="joinTime"    column="join_time"    />
        <result property="leaveTime"    column="leave_time"    />
        <result property="lastHeartbeat"    column="last_heartbeat"    />
        <result property="status"    column="status"    />
        <result property="queuePosition"    column="queue_position"    />
        <result property="createdAt"    column="created_at"    />
        <result property="updatedAt"    column="updated_at"    />
    </resultMap>

    <sql id="selectRedpacketActivityParticipantsVo">
        select id, user_id, session_id, ip_address, join_time, leave_time, last_heartbeat, status, queue_position, created_at, updated_at from redpacket_activity_participants
    </sql>

    <select id="selectRedpacketActivityParticipantsList" parameterType="RedpacketActivityParticipants" resultMap="RedpacketActivityParticipantsResult">
        <include refid="selectRedpacketActivityParticipantsVo"/>
        <where>  
            <if test="userId != null  and userId != ''"> and user_id = #{userId}</if>
            <if test="sessionId != null  and sessionId != ''"> and session_id like concat('%', #{sessionId}, '%')</if>
            <if test="ipAddress != null  and ipAddress != ''"> and ip_address like concat('%', #{ipAddress}, '%')</if>
            <if test="params.beginJoinTime != null and params.beginJoinTime != '' and params.endJoinTime != null and params.endJoinTime != ''"> and join_time between #{params.beginJoinTime} and #{params.endJoinTime}</if>
            <if test="params.beginLeaveTime != null and params.beginLeaveTime != '' and params.endLeaveTime != null and params.endLeaveTime != ''"> and leave_time between #{params.beginLeaveTime} and #{params.endLeaveTime}</if>
            <if test="params.beginLastHeartbeat != null and params.beginLastHeartbeat != '' and params.endLastHeartbeat != null and params.endLastHeartbeat != ''"> and last_heartbeat between #{params.beginLastHeartbeat} and #{params.endLastHeartbeat}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="queuePosition != null "> and queue_position = #{queuePosition}</if>
            <if test="params.beginCreatedAt != null and params.beginCreatedAt != '' and params.endCreatedAt != null and params.endCreatedAt != ''"> and created_at between #{params.beginCreatedAt} and #{params.endCreatedAt}</if>
        </where>
    </select>
    
    <select id="selectRedpacketActivityParticipantsById" parameterType="Long" resultMap="RedpacketActivityParticipantsResult">
        <include refid="selectRedpacketActivityParticipantsVo"/>
        where id = #{id}
    </select>

    <insert id="insertRedpacketActivityParticipants" parameterType="RedpacketActivityParticipants" useGeneratedKeys="true" keyProperty="id">
        insert into redpacket_activity_participants
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">user_id,</if>
            <if test="sessionId != null and sessionId != ''">session_id,</if>
            <if test="ipAddress != null">ip_address,</if>
            <if test="joinTime != null">join_time,</if>
            <if test="leaveTime != null">leave_time,</if>
            <if test="lastHeartbeat != null">last_heartbeat,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="queuePosition != null">queue_position,</if>
            <if test="createdAt != null">created_at,</if>
            <if test="updatedAt != null">updated_at,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">#{userId},</if>
            <if test="sessionId != null and sessionId != ''">#{sessionId},</if>
            <if test="ipAddress != null">#{ipAddress},</if>
            <if test="joinTime != null">#{joinTime},</if>
            <if test="leaveTime != null">#{leaveTime},</if>
            <if test="lastHeartbeat != null">#{lastHeartbeat},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="queuePosition != null">#{queuePosition},</if>
            <if test="createdAt != null">#{createdAt},</if>
            <if test="updatedAt != null">#{updatedAt},</if>
         </trim>
    </insert>

    <update id="updateRedpacketActivityParticipants" parameterType="RedpacketActivityParticipants">
        update redpacket_activity_participants
        <trim prefix="SET" suffixOverrides=",">
            <if test="userId != null">user_id = #{userId},</if>
            <if test="sessionId != null and sessionId != ''">session_id = #{sessionId},</if>
            <if test="ipAddress != null">ip_address = #{ipAddress},</if>
            <if test="joinTime != null">join_time = #{joinTime},</if>
            <if test="leaveTime != null">leave_time = #{leaveTime},</if>
            <if test="lastHeartbeat != null">last_heartbeat = #{lastHeartbeat},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="queuePosition != null">queue_position = #{queuePosition},</if>
            <if test="createdAt != null">created_at = #{createdAt},</if>
            <if test="updatedAt != null">updated_at = #{updatedAt},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteRedpacketActivityParticipantsById" parameterType="Long">
        delete from redpacket_activity_participants where id = #{id}
    </delete>

    <delete id="deleteRedpacketActivityParticipantsByIds" parameterType="String">
        delete from redpacket_activity_participants where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
</mapper>